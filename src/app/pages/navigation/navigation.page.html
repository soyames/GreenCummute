<ion-header>
  <ion-toolbar>
    <ion-title>Navigation</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="map-container">
    <div id="map-container" style="height: 350px; width: 100%; z-index: 0;"></div>
  </div>

  <ion-card>
    <ion-card-header>
      <ion-card-title>Plan Your Eco Route</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-item>
        <ion-icon name="location" slot="start" color="success"></ion-icon>
        <ion-input 
          [(ngModel)]="originAddress" 
          label="From" 
          labelPlacement="floating"
          placeholder="Enter starting location"
          (ionInput)="onOriginInput($event)"
          [disabled]="isNavigating">
        </ion-input>
        <ion-button slot="end" fill="clear" (click)="useCurrentLocation()" [disabled]="isNavigating">
          <ion-icon name="locate" color="primary"></ion-icon>
        </ion-button>
      </ion-item>
      
      <!-- Origin suggestions -->
      <ion-list *ngIf="originSuggestions.length > 0" class="suggestions-list">
        <ion-item 
          *ngFor="let suggestion of originSuggestions" 
          button 
          (click)="selectOriginSuggestion(suggestion)">
          <ion-icon name="location-outline" slot="start"></ion-icon>
          <ion-label>{{ suggestion.display_name }}</ion-label>
        </ion-item>
      </ion-list>

      <ion-item>
        <ion-icon name="location" slot="start" color="danger"></ion-icon>
        <ion-input 
          [(ngModel)]="destinationAddress" 
          label="To" 
          labelPlacement="floating"
          placeholder="Enter destination"
          (ionInput)="onDestinationInput($event)"
          [disabled]="isNavigating">
        </ion-input>
      </ion-item>
      
      <!-- Destination suggestions -->
      <ion-list *ngIf="destinationSuggestions.length > 0" class="suggestions-list">
        <ion-item 
          *ngFor="let suggestion of destinationSuggestions" 
          button 
          (click)="selectDestinationSuggestion(suggestion)">
          <ion-icon name="location-outline" slot="start"></ion-icon>
          <ion-label>{{ suggestion.display_name }}</ion-label>
        </ion-item>
      </ion-list>

      <div class="transport-modes">
        <h4>Transport Modes</h4>
        <div class="mode-chips">
          <ion-chip 
            *ngFor="let mode of ['walk', 'bike', 'ebike', 'scooter', 'bus', 'train', 'tram']"
            [color]="isTransportModeSelected(mode) ? 'primary' : 'medium'"
            (click)="!isNavigating && toggleTransportMode(mode)"
            [disabled]="isNavigating"
            style="cursor: pointer;">
            <ion-icon [name]="transportModeIcons[mode]" slot="start"></ion-icon>
            <ion-label>{{ mode | titlecase }}</ion-label>
          </ion-chip>
        </div>
      </div>

      <ion-item>
        <ion-label>Optimize For</ion-label>
        <ion-select 
          [(ngModel)]="optimizeFor" 
          [disabled]="isNavigating">
          <ion-select-option value="eco">Most Eco-Friendly</ion-select-option>
          <ion-select-option value="balanced">Balanced</ion-select-option>
          <ion-select-option value="time">Fastest</ion-select-option>
        </ion-select>
      </ion-item>

      <ion-button 
        expand="block" 
        (click)="calculateRoutes()"
        [disabled]="isCalculating || isNavigating">
        <ion-icon name="search" slot="start"></ion-icon>
        Calculate Routes
      </ion-button>
    </ion-card-content>
  </ion-card>

  <ion-card *ngIf="routeComparison && routeComparison.routes.length > 0">
    <ion-card-header>
      <ion-card-title>Route Options</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list>
        <ion-item 
          *ngFor="let route of routeComparison.routes"
          [color]="selectedRoute?.id === route.id ? 'light' : ''"
          button
          (click)="selectRoute(route)"
          [disabled]="isNavigating">
          <ion-icon 
            [name]="transportModeIcons[route.transportMode]" 
            slot="start" 
            [color]="getEcoScoreColor(route.ecoScore)">
          </ion-icon>
          <ion-label>
            <h3>{{ route.transportMode | titlecase }}</h3>
            <p>{{ formatDistance(route.distance) }} â€¢ {{ formatDuration(route.duration) }}</p>
            <p>
              <ion-badge [color]="getEcoScoreColor(route.ecoScore)">
                Eco: {{ route.ecoScore }}/100
              </ion-badge>
              <ion-badge color="success" class="ml-2">
                +{{ route.pointsEarned }} points
              </ion-badge>
              <ion-badge color="success" class="ml-2">
                -{{ route.co2Saved }}g CO2
              </ion-badge>
            </p>
          </ion-label>
          <ion-icon 
            name="checkmark-circle" 
            slot="end" 
            color="primary"
            *ngIf="selectedRoute?.id === route.id">
          </ion-icon>
        </ion-item>
      </ion-list>

      <div class="navigation-buttons" *ngIf="selectedRoute">
        <ion-button 
          expand="block" 
          color="success"
          (click)="startNavigation()"
          *ngIf="!isNavigating">
          <ion-icon name="navigate" slot="start"></ion-icon>
          Start Navigation
        </ion-button>

        <ion-button 
          expand="block" 
          color="danger"
          (click)="endNavigation()"
          *ngIf="isNavigating">
          <ion-icon name="stop-circle" slot="start"></ion-icon>
          Complete Route
        </ion-button>
      </div>
    </ion-card-content>
  </ion-card>

  <app-data-disclaimer [showFullDisclaimer]="false" position="bottom"></app-data-disclaimer>
</ion-content>
