<ion-header>
  <ion-toolbar>
    <ion-title>Statistics</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-segment [(ngModel)]="timeframe" (ionChange)="onTimeframeChange($event)">
    <ion-segment-button value="week">
      <ion-label>Week</ion-label>
    </ion-segment-button>
    <ion-segment-button value="month">
      <ion-label>Month</ion-label>
    </ion-segment-button>
    <ion-segment-button value="year">
      <ion-label>Year</ion-label>
    </ion-segment-button>
    <ion-segment-button value="alltime">
      <ion-label>All Time</ion-label>
    </ion-segment-button>
  </ion-segment>

  <ion-card class="stats-overview">
    <ion-card-content>
      <ion-grid>
        <ion-row>
          <ion-col size="6">
            <div class="stat-item">
              <ion-icon name="leaf" color="success"></ion-icon>
              <div class="stat-value">{{ stats.totalPoints }}</div>
              <div class="stat-label">Points</div>
            </div>
          </ion-col>
          <ion-col size="6">
            <div class="stat-item">
              <ion-icon name="navigate" color="primary"></ion-icon>
              <div class="stat-value">{{ stats.totalRoutes }}</div>
              <div class="stat-label">Routes</div>
            </div>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col size="6">
            <div class="stat-item">
              <ion-icon name="speedometer" color="warning"></ion-icon>
              <div class="stat-value">{{ formatDistance(stats.totalDistance) }}</div>
              <div class="stat-label">Distance</div>
            </div>
          </ion-col>
          <ion-col size="6">
            <div class="stat-item">
              <ion-icon name="earth" color="tertiary"></ion-icon>
              <div class="stat-value">{{ formatCO2(stats.totalCO2Saved) }}</div>
              <div class="stat-label">CO₂ Saved</div>
            </div>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card-content>
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-card-title>Environmental Impact</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div class="impact-item">
        <ion-icon name="leaf-outline" color="success"></ion-icon>
        <div class="impact-text">
          <h3>Trees Equivalent</h3>
          <p>Your CO₂ savings equal {{ getTreesEquivalent().toFixed(2) }} trees per year</p>
        </div>
      </div>
      <div class="impact-item">
        <ion-icon name="flame-outline" color="danger"></ion-icon>
        <div class="impact-text">
          <h3>Eco Score</h3>
          <p>Average eco-friendliness: {{ stats.averageEcoScore }}/100</p>
        </div>
      </div>
      <div class="impact-item">
        <ion-icon name="calendar-outline" color="primary"></ion-icon>
        <div class="impact-text">
          <h3>Streak</h3>
          <p>Current: {{ stats.currentStreak }} days • Best: {{ stats.longestStreak }} days</p>
        </div>
      </div>
    </ion-card-content>
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-card-title>Transport Mode Breakdown</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list>
        <ion-item *ngFor="let mode of stats.transportModeBreakdown">
          <ion-icon [name]="getTransportModeIcon(mode.mode)" slot="start"></ion-icon>
          <ion-label>
            <h3>{{ mode.mode | titlecase }}</h3>
            <p>{{ mode.count }} trips • {{ formatDistance(mode.distance) }}</p>
            <ion-progress-bar 
              [value]="getModePercentage(mode.count) / 100"
              color="primary">
            </ion-progress-bar>
          </ion-label>
          <ion-note slot="end">
            {{ getModePercentage(mode.count).toFixed(0) }}%
          </ion-note>
        </ion-item>
      </ion-list>

      <div *ngIf="stats.transportModeBreakdown.length === 0" class="empty-state">
        <ion-icon name="stats-chart-outline" color="medium"></ion-icon>
        <p>No transport data yet</p>
      </div>
    </ion-card-content>
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-card-title>Achievements</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div class="achievements-grid">
        <div *ngFor="let achievement of stats.achievements" 
             class="achievement-badge"
             [class.unlocked]="achievement.unlocked">
          <ion-icon [name]="achievement.icon"></ion-icon>
          <span class="badge-label">{{ achievement.name }}</span>
        </div>
      </div>
      <p *ngIf="stats.achievements.length === 0" class="text-center">No achievements yet</p>
    </ion-card-content>
  </ion-card>

  <ion-refresher slot="fixed" (ionRefresh)="loadStatistics()">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>
</ion-content>
